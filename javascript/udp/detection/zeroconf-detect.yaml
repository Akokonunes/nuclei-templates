id: zeroconf-detect

info:
  name: Zeroconf - Detect
  author: pussycat0x
  severity: info
  description: |
    Detects Zeroconf (mDNS/DNS-SD) services by querying _services._dns-sd._udp.local on UDP/5353 and identifying advertised local services.
  reference:
    - https://en.wikipedia.org/wiki/Zero-configuration_networking
  metadata:
    verified: true
    zoomeye-query: service="zeroconf"
  tags: zeroconf,network,js,udp

javascript:
  - pre-condition: |
      isUDPPortOpen(Host,Port);
    code: |
      let packet = bytes.NewBuffer();
      const c = require("nuclei/net");
      const cmd = "000000000001000000000000095f7365727669636573075f646e732d7364045f756470056c6f63616c00000c0001"
      packet.WriteString(cmd)
      let conn = c.Open('udp', `${Host}:${Port}`);
      conn.SendHex(packet);
      const result = conn.RecvFullHex();
      result

    args:
      Host: "{{Host}}"
      Port: 5353

    matchers:
      - type: dsl
        dsl:
          - 'success == true'
          - 'contains(response, "udp.local") && contains(response, "rvices._dns-sd") || contains(response, "-servers.net")'
        condition: and
