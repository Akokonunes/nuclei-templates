id: graphql-directive-overloading

info:
  name: GraphQL Directive Overloading
  author: shamo0
  severity: info
  description: |
    GraphQL directive overloading occurs when multiple duplicated directives are allowed in a single query, potentially leading to denial of service attacks or resource exhaustion.
  impact: |
    An attacker could exploit directive overloading to consume excessive server resources, potentially leading to denial of service conditions.
  remediation: |
    Configure GraphQL server to limit or prevent directive overloading by implementing proper validation and rate limiting.
  reference:
    - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/12-API_Testing/01-Testing_GraphQL
  metadata:
    verified: true
    max-request: 1
  tags: graphql,dos,misconfig

http:
  - raw:
      - |
        POST /graphql HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
          "query": "query { __typename @aa @aa @aa @aa @aa @aa @aa @aa @aa @aa }"
        }

    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: regex
        part: body
        regex:
          - "\\\"errors\\\":\\s*\\[.*?\\]"
      - type: regex
        part: body
        regex:
          - "\\\"message\\\":\\s*\\\".*?@aa.*?\\\""

    extractors:
      - type: regex
        name: directive_errors
        part: body
        regex:
          - "\\\"errors\\\":\\s*\\[.*?\\]"